var canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),fps=30,interval=1e3/fps,backgroundTotalSeconds=0,backgroundVx=5,backgroundNumImages=Math.ceil(canvas.width/3500)+1,backgroundXpos=0,sounds={engine:new Audio("sounds/590329main_ringtone_SDO_launchNats.mp3"),weathertest:new Audio("sounds/581100main_Apollo-12_All-Weather-Testing.m4r"),countdown:new Audio("sounds/590319main_ringtone_apollo11_countdown.m4r"),clockstart:new Audio("sounds/582399main_Mercury-4_Clock-Started.m4r"),cardiacsim:new Audio("sounds/584851main_Apollo-12_Cardiac-Sim.mp3")},audioPlayer=document.getElementById("audioplayer"),backgroundImage=new Image;backgroundImage.onload=function(){settings.backgroundImageReady=!0},backgroundImage.src="images/clouds.jpg";var launchpadImage=new Image;launchpadImage.onload=function(){settings.launchpadImageReady=!0,ctx.drawImage(launchpadImage,0,0)},launchpadImage.src="images/launchpad.png";var rocketImage=new Image;rocketImage.onload=function(){settings.rocketImageReady=!0},rocketImage.src="images/rocket.png";var moonImage=new Image;moonImage.onload=function(){settings.moonImageReady=!0},moonImage.src="images/moon.png";var stage1Image=new Image;stage1Image.onload=function(){settings.stage1ImageReady=!0},stage1Image.src="images/stage-1.png";var stage2Image=new Image;stage2Image.onload=function(){settings.stage2ImageReady=!0},stage2Image.src="images/stage-2.png";var stage3Image=new Image;stage3Image.onload=function(){settings.stage3ImageReady=!0},stage3Image.src="images/stage-3.png";var stage4Image=new Image;stage4Image.onload=function(){settings.stage4ImageReady=!0},stage4Image.src="images/stage-4.png";var lunarmoduleImage=new Image;lunarmoduleImage.onload=function(){settings.lunarmoduleImageReady=!0},lunarmoduleImage.src="images/lunarmodule.png";var exhaustImage=new Image;exhaustImage.onload=function(){settings.exhaustImageReady=!0},exhaustImage.src="images/exhaust.gif";var settings={fall:!1,finish:!1,gameover:!1,planetImageReady:!1,rocketImageReady:!1,backgroundImageReady:!1,exhaustImageReady:!1,ignition:!1,rocketX:123,rocketY:322,lunarModuleX:90,lunarModuleY:90,lunarModuleMovementDirection:"right",gamestatus:"launch",stage1x:0,stage1y:460,stage2x:38,stage2y:423,stage3x:61,stage3y:399,stage4x:86,stage4y:374,decouple:!1,currentStage:0},performCheck=function(e){switch(document.getElementById(e).classList.add("button-square-click"),e){case"weathertest":case"clockstart":case"cardiacsim":sounds[e].play(),setTimeout(confirmButton,1e3),setTimeout(confirmCheck,4e3),document.getElementById("console").value="Performing "+e+"...\n";break;case"boostpreparation":case"systemscheck":case"communicationscheck":setTimeout(confirmButton,1e3),setTimeout(confirmCheck,4e3),document.getElementById("console").value="Performing "+e+"...\n";break;default:console.log("invalid parameters")}},confirmButton=function(){var e=document.querySelectorAll(".button-square");[].forEach.call(e,function(e){e.classList.remove("button-square-click")})},confirmCheck=function(){document.getElementById("console").value=document.getElementById("console").value+"status...ok \n"},keysDown={};addEventListener("keydown",function(e){37==e.keyCode&&(settings.lunarModuleMovementDirection="left"),39==e.keyCode&&(settings.lunarModuleMovementDirection="right"),32==e.keyCode&&(settings.decouple=!0,settings.currentStage+=1)},!1);var update=function(e){if(settings.ignition&&(audioPlayer.play(),settings.rocketY-=10*e),"launched"==settings.gamestatus)if(settings.stage4x>400)0==settings.decouple?settings.gameover=!0:(settings.gamestatus="landing",backgroundImage.src="images/moonsurface.jpg",document.getElementById("controlpanel").innerHTML="<h2>Navigate left and right to land the Apollo Lunar Module Eagle on the moon.</h2>");else if(settings.decouple)switch(settings.rocketSaturnX-=1*e,settings.rocketSaturnY+=1*e,settings.currentStage){case 1:settings.stage1x-=1*e,settings.stage1y+=1*e,settings.stage2x+=5*e,settings.stage2y-=5*e,settings.stage3x+=5*e,settings.stage3y-=5*e,settings.stage4x+=5*e,settings.stage4y-=5*e;break;case 2:settings.stage1x-=1*e,settings.stage1y+=1*e,settings.stage2x-=1*e,settings.stage2y+=1*e,settings.stage3x+=5*e,settings.stage3y-=5*e,settings.stage4x+=5*e,settings.stage4y-=5*e;break;case 3:settings.stage1x-=1*e,settings.stage1y+=1*e,settings.stage2x-=1*e,settings.stage2y+=1*e,settings.stage3x-=1*e,settings.stage3y+=1*e,settings.stage4x+=5*e,settings.stage4y-=5*e;break;case 1:settings.stage1x-=1*e,settings.stage1y+=1*e}else settings.stage1x+=5*e,settings.stage1y-=5*e,settings.stage2x+=5*e,settings.stage2y-=5*e,settings.stage3x+=5*e,settings.stage3y-=5*e,settings.stage4x+=5*e,settings.stage4y-=5*e;if("landing"==settings.gamestatus&&settings.lunarModuleY<504)switch(settings.lunarModuleY+=5*e,settings.lunarModuleMovementDirection){case"left":settings.lunarModuleX-=5*e;break;case"right":settings.lunarModuleX+=5*e}if(settings.lunarModuleY>504&&(settings.finish=!0),"launch"==settings.gamestatus&&settings.rocketY<-250){audioPlayer.src="",audioPlayer.pause(),audioPlayer.currentTime=0,settings.gamestatus="launched",backgroundImage.src="images/space.jpg";for(var t=document.getElementById("controlpanel");t.hasChildNodes();)t.removeChild(t.firstChild);document.getElementById("controlpanel").innerHTML="<h2>Press space button to initiate new stages.</h2>"}"launch"==settings.gamestatus&&(backgroundXpos=(backgroundTotalSeconds+=e)*backgroundVx%3500)},render=function(){if(ctx.clearRect(0,0,800,600),ctx.drawImage(backgroundImage,0,0),settings.backgroundImageReady&&"launch"==settings.gamestatus){ctx.save(),ctx.translate(-backgroundXpos,0);for(var e=0;e<backgroundNumImages;e++)ctx.drawImage(backgroundImage,3500*e,0);ctx.restore()}"launched"==settings.gamestatus&&(ctx.drawImage(stage1Image,settings.stage1x,settings.stage1y),ctx.drawImage(stage2Image,settings.stage2x,settings.stage2y),ctx.drawImage(stage3Image,settings.stage3x,settings.stage3y),ctx.drawImage(stage4Image,settings.stage4x,settings.stage4y),ctx.drawImage(moonImage,550,50)),settings.launchpadImageReady&&"launch"==settings.gamestatus&&ctx.drawImage(launchpadImage,90,307),settings.rocketImageReady&&"launch"==settings.gamestatus&&(ctx.drawImage(rocketImage,settings.rocketX,settings.rocketY),settings.exhaustImageReady&&settings.ignition&&ctx.drawImage(exhaustImage,settings.rocketX,settings.rocketY+180)),settings.lunarmoduleImageReady&&"landing"==settings.gamestatus&&ctx.drawImage(lunarmoduleImage,settings.lunarModuleX,settings.lunarModuleY),settings.finish&&(ctx.font="60px Arial",ctx.fillStyle="green",ctx.fillText("You did it!",canvas.width/2-100,canvas.height/2-100)),settings.gameover&&0==settings.decouple&&(ctx.font="20px Arial",ctx.fillStyle="red",ctx.fillText("Game over! You didn't decouple on time!",canvas.width/2-250,canvas.height/2-100))},liftOff=function(){settings.ignition=!0,document.getElementById("console").value=document.getElementById("console").value+"We have a liftoff...\n"},launch=function(){sounds.countdown.play(),document.getElementById("launch").classList.add("button-round-click"),document.getElementById("console").value="Launch sequence initiated. Lift off countdown...\n",setTimeout(liftOff,1e4)};addEventListener("keyup",function(e){},!1);var main=function(e){var t=Date.now(),a=t-then;update(a/1e3),render(),then=t-a%interval,settings.finish||settings.gameover?cancelAnimationFrame(recAF):recAF=requestAnimationFrame(main)},w=window;requestAnimationFrame=w.requestAnimationFrame||w.webkitRequestAnimationFrame||w.msRequestAnimationFrame||w.mozRequestAnimationFrame,cancelAnimationFrame=w.cancelAnimationFrame||w.mozCancelAnimationFrame;var then=Date.now();main();
